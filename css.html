<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ARnft example showing an simple red cube</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1">
	<link rel="stylesheet" href="nft-style.css">
	<p id="dateY"></p>
</head>
<body>

	<audio id="myAudio">
  <source src="chamran.mp3" type="audio/mpeg">
</audio>
	
	
		<script src="three.min.js"></script>
		<script src="ARnft.js"></script>
        <script type='text/javascript' src='Tween.js'></script>  
	<script src='threex.htmlmixer.js'></script>

    <script>
	    
	    let cssRenderer;
	    let cssObject;
	    let planeMesh;
	    let cssScene;
	    let rt;
	    let w;
	    let h;
	    
	    let mixerContext;
	    
      
			ARnft.ARnft.init(800, 600, "archive/DataNFT/notebook", 'config3.json', true, true)
			.then((nft) => {
				rt = nft;
				document.addEventListener('onInitThreejsRendering', (ev) => {
					const renderer = ev.detail.renderer;
					const scene = ev.detail.scene;
					const camera = ev.detail.camera;
					
					try{
						renderer.autoClear	= false;
					}catch(e){alert(e)}
  					renderer.outputEncoding = THREE.sRGBEncoding;
                                        renderer.textureEncoding = THREE.sRGBEncoding
					renderer.physicallyCorrectLights = true;
				
					const light1  = new THREE.AmbientLight(0xFFFFFF, 0.3);
					    light1.name = 'ambient_light';
					    camera.add( light1 );

					let directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8 * Math.PI);
					directionalLight.position.set(0.5, 0, 0.866);
					camera.add(directionalLight);
	
				})
				
				
				document.addEventListener('onAfterInitThreejsRendering', (ev) => {
				try{

					
	var renderer	= nft.renderer.renderer;

	//bvar updateFcts	= [];
	//var scene	= nft.renderer.scene;
					var scene = nft.root;
	var camera	= nft.renderer.camera;
					w = window.innerWidth
					h = window.innerHeight 
	
	//////////////////////////////////////////////////////////////////////////////////
	//		create THREEx.HtmlMixer						//
	//////////////////////////////////////////////////////////////////////////////////
	 mixerContext= new THREEx.HtmlMixer.Context(renderer, scene, camera)

	// handle window resize for mixerContext
	window.addEventListener('resize', function(){
		mixerContext.rendererCss.setSize( w,h)
	}, false)


	//////////////////////////////////////////////////////////////////////////////////
	//		mixerContext configuration and dom attachement
	//////////////////////////////////////////////////////////////////////////////////

 	// set up rendererCss
	var rendererCss		= mixerContext.rendererCss
	rendererCss.setSize( w, h )
	// set up rendererWebgl
	var rendererWebgl	= mixerContext.rendererWebgl


	var css3dElement		= rendererCss.domElement
	css3dElement.style.position	= 'absolute'
	css3dElement.style.top		= '0px'
	css3dElement.style.width	= '100%'
	css3dElement.style.height	= '100%'
	document.body.appendChild( css3dElement )
	
	var webglCanvas			= rendererWebgl.domElement
	webglCanvas.style.position	= 'absolute'
	webglCanvas.style.top		= '0px'
	webglCanvas.style.width		= '100%'
	webglCanvas.style.height	= '100%'
	webglCanvas.style.pointerEvents	= 'none'
	css3dElement.appendChild( webglCanvas )
	
	//////////////////////////////////////////////////////////////////////////////////
	//		create a Plane for THREEx.HtmlMixer				//
	//////////////////////////////////////////////////////////////////////////////////
	

	// create the iframe element
	var url		= 'http://threejs.org/';
	var domElement	= document.createElement('iframe')
	domElement.src	= url
	domElement.style.border	= 'none'

	// create the plane
	var mixerPlane	= new THREEx.HtmlMixer.Plane(mixerContext, domElement)
	mixerPlane.object3d.scale.set(200,200,200);
	scene.add(mixerPlane.object3d)
	nft.tickExtend = function (){
                                                       mixerContext.update()
						}				
					
				}catch(e){
					alert(e)
				}
					
				});
			
				document.addEventListener('getWindowSize', (ev) => {
				      w = ev.detail.sw
				      h = ev.detail.sh
					
					try{
//alert("setsize init");
						mixerContext.rendererCss.setSize(w,h)
						
//alert("finish setsize");
					      }catch(e){
						      alert(e)
					      }
					
				});
				
				document.addEventListener('getMatrixGL_RH', (ev) => {
					try{
			
					}catch(e){
						alert(e)
					}
				});
            });

    </script>
</body>

</html>
