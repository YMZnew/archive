<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ARnft example showing an simple red cube</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1">
	<link rel="stylesheet" href="nft-style.css">
</head>
<body>

<!--<iframe src="https://en.wikipedia.org/wiki/Ali" height="200" width="300" id="myifr"></iframe>-->
     <!-- <a
          href="https://raw.githubusercontent.com/artoolkitx/artoolkit5/master/doc/Marker%20images/pinball.jpg"
          class="ui marker"
          target="_blank">
          ðŸ–¼ Marker Image
      </a> -->

		<script src="three.min.js"></script>
		<script src="ARnft.js"></script>
	<script src="three.interactive.js"></script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  

    <script>
	    
	    let rt; 
	    let sc ;
	    
	    let rndrr = "YMZ";
	    let lamp ;
	    let phone ;
	    let water;
	    let mobile;
	    let ifram;
	    let sss;
	    let mat ;
	    const trackedMatrix = {
  // for interpolation
  delta: [
    0, 0, 0, 0,
    0, 0, 0, 0,
    0, 0, 0, 0,
    0, 0, 0, 0
  ],
  interpolated: [
    0, 0, 0, 0,
    0, 0, 0, 0,
    0, 0, 0, 0,
    0, 0, 0, 0
  ]
	    };
	    
	    
	    function adjugate(m) { // Compute the adjugate of m
    return [
        m[4]*m[8]-m[7]*m[5],m[7]*m[2]-m[1]*m[8],m[1]*m[5]-m[4]*m[2],
        m[6]*m[5]-m[3]*m[8],m[0]*m[8]-m[6]*m[2],m[3]*m[2]-m[0]*m[5],
        m[3]*m[7]-m[6]*m[4],m[6]*m[1]-m[0]*m[7],m[0]*m[4]-m[3]*m[1]
    ];
}

function multiply(a,b) { // multiply two matrices
    a = [
        a[0],a[3],a[6],
        a[1],a[4],a[7],
        a[2],a[5],a[8]
    ];

    b = [
        b[0],b[3],b[6],
        b[1],b[4],b[7],
        b[2],b[5],b[8]
    ];

    var m = Array(9);

    for (var i = 0; i != 3; ++i) {
        for (var j = 0; j != 3; ++j) {
            var mij = 0;
            for (var k = 0; k != 3; ++k) {
                mij += a[3*i + k]*b[3*k + j];
            }
            m[3*i + j] = mij;
        }
    }

    return [
        m[0],m[3],m[6],
        m[1],m[4],m[7],
        m[2],m[5],m[8]
    ];
}

function apply(m,v) { // multiply matrix and vector
    return [
        m[0]*v[0] + m[3]*v[1] + m[6]*v[2],
        m[1]*v[0] + m[4]*v[1] + m[7]*v[2],
        m[2]*v[0] + m[5]*v[1] + m[8]*v[2]
    ];
}
	    
	     function interpolating (world) {
    const interpolationFactor = 24

    // interpolate matrix
    for (let i = 0; i < 16; i++) {
      trackedMatrix.delta[i] = world[i] - trackedMatrix.interpolated[i]
      trackedMatrix.interpolated[i] =
                  trackedMatrix.interpolated[i] +
                  trackedMatrix.delta[i] / interpolationFactor
    }
    return trackedMatrix.interpolated
  }
	   

	    
			ARnft.ARnft.init(800, 600, "archive/DataNFT/metro", 'config3.json', true, true)
			.then((nft) => {
				
				
				
					
// 				iframe = document.createElement("iframe");
//                                 iframe.setAttribute("id", "myIframe");
// 				iframe.src = ; 
// 				iframe.style.position = "absolute"; 
// 				iframe.style.left = "0"; 
// 				iframe.style.top = "0"; 
// 				iframe.style.transformOrigin = "0 0"; 
				//document.querySelector("body").appendChild(iframe);
// 				let mat = new THREE.MeshLambertMaterial({color: 0xff0000});
// 				let cubeGeom = new THREE.CubeGeometry(1,1,1);
// 				let cube = new THREE.Mesh(cubeGeom, mat);
// 				cube.position.z = 90;
// 				cube.scale.set(180,180,180);
// 				nft.add(cube);
				
// 				 document.addEventListener('getProjectionMatrix', (ev) => {
//       console.log("YMA - "+ev.detail.proj);
//       console.log(ev.detail);
//     })
				

				document.addEventListener('onInitThreejsRendering', (ev) => {
					sc = ev ;
					console.log("YMZ - " + ev.detail);
					const renderer = ev.detail.renderer;
					console.log(renderer);
					const scene = ev.detail.scene;
					console.log(scene);
					const camera = ev.detail.camera;
					console.log(camera);
					sc = scene;
  					renderer.outputEncoding = THREE.sRGBEncoding;
                                        renderer.textureEncoding = THREE.sRGBEncoding
					renderer.physicallyCorrectLights = true;
				
					const light1  = new THREE.AmbientLight(0xFFFFFF, 0.3);
					    light1.name = 'ambient_light';
					    camera.add( light1 );

					let directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8 * Math.PI);
					directionalLight.position.set(0.5, 0, 0.866);
					camera.add(directionalLight);
					
			    
			    		console.log("YMZ.YMA  - dom = " + renderer.domElement);
					
// var mixerContext	= new THREEx.HtmlMixer.Context(renderer, scene, camera)

// var url		= 'http://threejs.com'
// var mixerPlane	= THREEx.HtmlMixer.createPlaneFromIframe(mixerContext, url)
// scene.add(mixerPlane.object3d)
				})
				
// 				nft.addModel('./tel2.glb' , 150 , 150 ,0,(Math.PI / 2), 0.5 , "telephone",function(){
// 					alert("YMZ");	
// 				});
				
				nft.addModel('./lamp1.glb', 280, 100, 0, 0 , 14,"lamp",function () { 
					 alert("lamp");
					});
// 			nft.addModel('./iphone12.glb' , 0 , 100 ,20,(Math.PI / 8), 600,"iphone12",function loaded() { 
// 					alert("iphone12");
// 					});
// 				 nft.addModel('./lamp1.glb' , 100 , 200 ,72,(Math.PI / 2), 20,"lamp",function loaded() { 
// 					 alert("lamp1");
// 					});
				document.addEventListener('onAfterInitThreejsRendering', (ev) => {
				    // set here extra rendering settings after onInitThreejsRendering
// 					 /rt = nft.root;
					try{
						
					//rndrr = ev.detail.renderer
					//domEvents =  new THREEx.DomEvents(rndrr.renderer.camera, rndrr.renderer.domElement);
// 						rndrr = ev.details.renderer;
// 						alert(ev.detail);
// 						val threejsrenderer = ev.detail.renderer;
// 						alert(threejsrenderer);
// 						val c = threejsrenderer.camera
//                                      domEvents = new THREEx.DomEvents(c, threejsrenderer.renderer.domElement);
					}catch(e){
						alert(e);
					}
					
// 					alert(rt.children.length);
					console.log('onAfterInitThreejsRendering is emitted after onInitThreejsRendering!');
				})
				
				try{
					//alert(domEvents);
// 			         nft.addModel('./water2.glb', 280, 100, 0,0, 500,function loaded(m) { 
// 					 alert("YMZ");
// 					});
// 				 nft.addModel('./tel.glb' , 10 , 100 ,0,0, 300,function loaded() { 
					
// 					});
				
// 				 nft.addModel('./iphone12.glb' , 110 , 100 ,20,0, 900,function loaded() { 
					
// 					});
// 				 lamp = nft.addModel('./lamp1.glb' , 100 , 200 ,72,0, 20,function loaded() { 
					 
// 					});
					
// 					 nft.addModel('./setareyek.glb' , 10 , 100 ,0,0, 300,function loaded() { 
					
// 					});
				rt = nft
				
// 				nft.addModel('./lamp.glb',80,100,100,50);
// 				nft.addImage('./payment.jpg',0Xfffff,5);
				
				

                             // var domEvents = new THREEx.DomEvents(camera, renderer.domElement);
// 				//window.addEventListener( 'onClickEvent', onMouseMove, false );	
				//	document.addEventListener( 'mousemove', onClickEvent, false );  
// 				//	alert(nft.children.length);
				}catch(e){
				alert("YMZYMA : " +e );
				}
				
				

									try{
				var loader = new THREE.FontLoader();

loader.load( './iranyekan.json', function ( font ) {

    var textGeo = new THREE.TextGeometry( "ÛŒØ§ Ø¹Ù„ÛŒ", {

        font: font,

        size: 14,
        height: 10,
        curveSegments: 12,

        bevelThickness: 1,
        bevelSize: 5,
        bevelEnabled: true

    } );

    var textMaterial = new THREE.MeshPhongMaterial( { color: 0xff0000 } );

    var mesh = new THREE.Mesh( textGeo, textMaterial );
    mesh.position.set( 10, 200, 50 );
// mesh.callback = function() { console.log( this.name ); alert(this.name); }
//      nft.root.add( mesh );
	

} );
				}catch(e)
				{
					alert(e);	
				}
				//alert(nft.root);

			}).catch((error) => {
				alert(error);
				console.log(error);
			});
	    
	    function onClickEvent( event ) {

		    alert("YMZ");
	try{
	
		if(event.target == mobile){
			alert("YMZ - mobile");
		}
		else if(event.target == phone ) {
			alert("YMZ - phone");
		}
		else if(event.target == water ) {
			alert("YMZ - water");
		}
		else if(event.target == lamp ) {
			alert("YMZ - lamp");
		}else{
			alert("lamp is " + lamp );
			alert(event.target);	
		}
		
	}catch(e){
		alert(e);	
	}
	// calculate mouse position in normalized device coordinates
	// (-1 to +1) for both components

// 	mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
// 	mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

}
    </script>
</body>

</html>
