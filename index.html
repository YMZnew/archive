<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ARnft example showing an simple red cube</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1">
	<link rel="stylesheet" href="nft-style.css">
</head>
<body>

     <!-- <a
          href="https://raw.githubusercontent.com/artoolkitx/artoolkit5/master/doc/Marker%20images/pinball.jpg"
          class="ui marker"
          target="_blank">
          ðŸ–¼ Marker Image
      </a> -->

		<script src="three.min.js"></script>
		<script src="ARnft.js"></script>
         <script src='threex.htmlmixer.js'></script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      

    <script>
	    
	    const raycaster = new THREE.Raycaster();
	    let rt; 
	    let sc ;
const mouse = new THREE.Vector2();

function onClickEvent( event ) {

	try{
		alert(rt);
const intersects = raycaster.intersectObjects( sc.children );
	alert(intersects.length);
	alert(intersects[0]);
// 	alert(sc);
//	alert(sc.children);
// 	alert(sc.root);
// 	alert(rt.scene);
	}catch(e){
		alert(e);	
	}
	// calculate mouse position in normalized device coordinates
	// (-1 to +1) for both components

// 	mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
// 	mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

}
	    
			ARnft.ARnft.init(800, 600, "archive/DataNFT/metro", 'config2.json', true, true)
			.then((nft) => {
// 				let mat = new THREE.MeshLambertMaterial({color: 0xff0000});
// 				let cubeGeom = new THREE.CubeGeometry(1,1,1);
// 				let cube = new THREE.Mesh(cubeGeom, mat);
// 				cube.position.z = 90;
// 				cube.scale.set(180,180,180);
// 				nft.add(cube);
				
// 				 document.addEventListener('getProjectionMatrix', (ev) => {
//       console.log("YMA - "+ev.detail.proj);
//       console.log(ev.detail);
//     })
				
// 				document.addEventListener('getNFTMarker', (ev) => {
//       markerResult = { type: 'found', matrixGL_RH: JSON.stringify(ev.data.matrixGL_RH) 
// 		     }
//     })
				
				document.addEventListener('onInitThreejsRendering', (ev) => {
					console.log("YMZ - " + ev.detail);
					const renderer = ev.detail.renderer;
					console.log(renderer);
					const scene = ev.detail.scene;
					console.log(scene);
					const camera = ev.detail.camera;
					console.log(camera);
					sc = scene;
  					renderer.outputEncoding = THREE.sRGBEncoding;
                                        renderer.textureEncoding = THREE.sRGBEncoding
					renderer.physicallyCorrectLights = true;
					try{
                                       //renderer.setClearColor( 0xcccccc,0 );
						scene.background = null;
					}catch(e){
						alert(e);
					}
					
   
					const light1  = new THREE.AmbientLight(0xFFFFFF, 0.3);
					    light1.name = 'ambient_light';
					    camera.add( light1 );

					let directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8 * Math.PI);
					directionalLight.position.set(0.5, 0, 0.866);
					camera.add(directionalLight);
					
// var mixerContext	= new THREEx.HtmlMixer.Context(renderer, scene, camera)

// var url		= 'http://threejs.com'
// var mixerPlane	= THREEx.HtmlMixer.createPlaneFromIframe(mixerContext, url)
// scene.add(mixerPlane.object3d)
				})
				document.addEventListener('onAfterInitThreejsRendering', (ev) => {
				    // set here extra rendering settings after onInitThreejsRendering
					rt = nft.root;
					alert(rt.children.length);
					console.log('onAfterInitThreejsRendering is emitted after onInitThreejsRendering!');
				})
				
			
			         nft.addModel('./water2.glb', 280, 100, 0, 500);
// 				 nft.addModel('./iphone12.glb' , 300 , 80 ,0, 70);
				 nft.addModel('./tel.glb' , 10 , 100 ,0, 300);
				 nft.addModel('./iphone12.glb' , 110 , 100 ,20, 900);
				 nft.addModel('./lamp1.glb' , 100 , 200 ,72, 20);
				rt = nft
				
// 				nft.addModel('./lamp.glb',80,100,100,50);
// 				nft.addImage('./payment.jpg',0Xfffff,5);
				
				try{
// 				window.addEventListener( 'onClickEvent', onMouseMove, false );	
					document.addEventListener( 'mousemove', onClickEvent, false );  
// 					alert(nft.children.length);
				}catch(e){
				alert("YMZYMA : " +e );
				}
				
				

									try{
				var loader = new THREE.FontLoader();

loader.load( './iranyekan.json', function ( font ) {

    var textGeo = new THREE.TextGeometry( "ÛŒØ§ Ø¹Ù„ÛŒ", {

        font: font,

        size: 14,
        height: 10,
        curveSegments: 12,

        bevelThickness: 1,
        bevelSize: 5,
        bevelEnabled: true

    } );

    var textMaterial = new THREE.MeshPhongMaterial( { color: 0xff0000 } );

    var mesh = new THREE.Mesh( textGeo, textMaterial );
    mesh.position.set( 10, 200, 50 );
// mesh.callback = function() { console.log( this.name ); alert(this.name); }
//      nft.root.add( mesh );
	

} );
				}catch(e)
				{
					alert(e);	
				}
				//alert(nft.root);

			}).catch((error) => {
				alert(error);
				console.log(error);
			});
    </script>
</body>

</html>
